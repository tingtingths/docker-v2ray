name: Publish Docker

on:
  push:
    tags:
      - +

env:
    IMAGE_NAME: tingtingths/v2ray

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@master

            - name: Parse tag
              run: VERSION=$(echo "${{ github.ref }}" | sed -e 's,.*/\(.*\),\1,')

            - name: Publish to Registry
              uses: elgohr/Publish-Docker-Github-Action@master
              with:
                  name: $IMAGE_NAME
                  username: ${{ secrets.DOCKER_USERNAME }}
                  password: ${{ secrets.DOCKER_PASSWORD }}
                  tags: "latest,{{ VERSION }}"
